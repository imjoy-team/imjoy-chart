(this["webpackJsonpimjoy-chart-editor"]=this["webpackJsonpimjoy-chart-editor"]||[]).push([[0],{1279:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(47),s=a.n(o),i=(a(471),a(31)),c=a.n(i),l=a(75),u=a(163),d=a(164),p=a(165),h=a(174),f=a(172),j=a(173),b=a(166),m=a(167),x=a.n(m),v=a(12),g=a.n(v),y=a(465),O=a(8),S=a.n(O),w=a(255),P=a.n(w),k=a(72),C=a.n(k),I=a(46),F=a.n(I),U=a(116),E=a.n(U),D=a(5);function W(e,t){var a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}var L=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).inputFile=r.a.createRef(),n.exportWidth=1024,n.exportHeight=1024,n.exportFormat="png",n.exportFileName="imjoy-chart-export",n}return Object(d.a)(a,[{key:"render",value:function(){var e=this,t=this.context.localize,a=this.props.logoSrc&&Object(D.jsx)(P.a,{src:this.props.logoSrc}),n=[];if(this.props.dataSources)for(var r=0,o=Object.entries(this.props.dataSources);r<o.length;r++){var s=Object(j.a)(o[r],2),i=s[0],u=s[1];n.push(Object(D.jsxs)("li",{children:[i,":",u.length]},i))}var d=[];if(this.props.widgets){var p,h=Object(b.a)(this.props.widgets);try{var f=function(){var e=p.value;"form"===e.type?d.push(Object(D.jsx)(v.PlotlyFold,{name:e.name,children:Object(D.jsx)("div",{style:{padding:"10px"},children:Object(D.jsx)(y.a,{schema:e.schema,onChange:function(t){e.onChange&&e.onChange.apply(null,[t])},onSubmit:function(t){e.onSubmit&&e.onSubmit.apply(null,[t])},onError:function(t){e.onError&&e.onError.apply(null,[t])}})})},e.name)):"image"===e.type?d.push(Object(D.jsx)(v.PlotlyFold,{name:e.name,children:Object(D.jsx)("img",{style:{width:"100%",objectFit:"cover"},src:e.src})},e.name)):"html"===e.type&&d.push(Object(D.jsx)(v.PlotlyFold,{name:e.name,children:Object(D.jsx)("div",{style:{padding:"10px"},children:Object(D.jsx)("div",{dangerouslySetInnerHTML:{__html:e.body}})})},e.name))};for(h.s();!(p=h.n()).done;)f()}catch(g){h.e(g)}finally{h.f()}}var m=function(){var t=Object(l.a)(c.a.mark((function t(a){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=a||e.exportFormat,t.next=3,x.a.toImage(e.props.divId,{format:a,height:e.exportHeight,width:e.exportWidth});case 3:n=t.sent,W(e.exportFileName+"."+a.replace("full-json","json"),n);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(D.jsxs)(v.PanelMenuWrapper,{menuPanelOrder:this.props.menuPanelOrder,children:[a||null,Object(D.jsx)(v.GraphCreatePanel,{group:t("Structure"),name:t("Traces")}),Object(D.jsx)(v.GraphSubplotsPanel,{group:t("Structure"),name:t("Subplots")}),this.hasTransforms()&&Object(D.jsx)(v.GraphTransformsPanel,{group:t("Structure"),name:t("Transforms")}),Object(D.jsx)(v.StyleLayoutPanel,{group:t("Style"),name:t("General")}),Object(D.jsx)(v.StyleTracesPanel,{group:t("Style"),name:t("Traces")}),this.hasAxes()&&Object(D.jsx)(v.StyleAxesPanel,{group:t("Style"),name:t("Axes")}),this.hasMaps()&&Object(D.jsx)(v.StyleMapsPanel,{group:t("Style"),name:t("Maps")}),this.hasLegend()&&Object(D.jsx)(v.StyleLegendPanel,{group:t("Style"),name:t("Legend")}),this.hasColorbars()&&Object(D.jsx)(v.StyleColorbarsPanel,{group:t("Style"),name:t("Color Bars")}),Object(D.jsx)(v.StyleNotesPanel,{group:t("Annotate"),name:t("Text")}),Object(D.jsx)(v.StyleShapesPanel,{group:t("Annotate"),name:t("Shapes")}),Object(D.jsx)(v.StyleImagesPanel,{group:t("Annotate"),name:t("Images")}),this.hasSliders()&&Object(D.jsx)(v.StyleSlidersPanel,{group:t("Control"),name:t("Sliders")}),this.hasMenus()&&Object(D.jsx)(v.StyleUpdateMenusPanel,{group:t("Control"),name:t("Menus")}),this.props.children?this.props.children:null,Object(D.jsx)(v.LayoutPanel,{group:t("Annotate"),name:t("Info"),children:d}),Object(D.jsx)(v.LayoutPanel,{group:t("Export"),name:"image",children:Object(D.jsxs)(v.PlotlyFold,{children:[Object(D.jsx)(S.a,{label:"Width",children:Object(D.jsx)(C.a,{value:this.exportWidth,onChange:function(t){e.exportWidth=t,e.forceUpdate()},onUpdate:function(t){e.exportWidth=t,e.forceUpdate()},units:"px"})}),Object(D.jsx)(S.a,{label:"Height",children:Object(D.jsx)(C.a,{value:this.exportHeight,onChange:function(t){e.exportHeight=t,e.forceUpdate()},onUpdate:function(t){e.exportHeight=t,e.forceUpdate()},units:"px"})}),Object(D.jsx)(S.a,{label:"Format",children:Object(D.jsx)(F.a,{options:[{label:"PNG",value:"png"},{label:"JPEG",value:"jpeg"},{label:"WEBP",value:"webp"},{label:"SVG",value:"svg"},{label:"JSON",value:"full-json"}],value:this.exportFormat,onChange:function(t){e.exportFormat=t,e.forceUpdate()},clearable:!1})}),Object(D.jsx)(S.a,{label:"File Name",children:Object(D.jsx)(E.a,{value:this.exportFileName,defaultValue:this.exportFileName,onUpdate:function(t){e.exportFileName=t,e.forceUpdate()}})}),Object(D.jsx)(S.a,{children:Object(D.jsx)(v.Button,{variant:"primary",label:"Export",onClick:function(){m()}})})]})}),Object(D.jsxs)(v.SingleSidebarItem,{children:[Object(D.jsx)("input",{type:"file",onChange:function(t){e.props.handleLoadData(t.target.files[0])},ref:this.inputFile,style:{display:"none"}}),Object(D.jsx)(v.Button,{variant:"primary",label:"Load",onClick:function(){e.inputFile.current.click()}})]}),Object(D.jsx)(v.SingleSidebarItem,{children:Object(D.jsx)(v.Button,{variant:"primary",label:"save",onClick:Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.props.handleSaveData?e.props.handleLoadData(e.props.data):m("full-json");case 1:case"end":return t.stop()}}),t)})))})})]})}}]),a}(v.DefaultEditor),T=(a(1259),a(463)),A=a(464),H={editable:!0};function N(e){return new Promise((function(t,a){A.parse(e,{download:!0,header:!0,dynamicTyping:!0,skipEmptyLines:!0,error:function(e,t,n,r){alert("Falied to load the table: "+r.toString()),a(r)},complete:function(e){t(function(e){var t,a={},n=Object(b.a)(e);try{for(n.s();!(t=n.n()).done;)for(var r=t.value,o=0,s=Object.entries(r);o<s.length;o++){var i=Object(j.a)(s[o],2),c=i[0],l=i[1];a[c]=a[c]||[],a[c].push(l)}}catch(u){n.e(u)}finally{n.f()}return a}(e.data))}})}))}var B=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(u.a)(this,a),(e=t.call(this)).widgets=[],e.plotDivId="_"+Math.random().toString(36).substr(2,9),e._initPromise=new Promise((function(t){e._initPromiseResolve=t}));var n=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}("load");if(e.saveDataHandler=null,n?N(n).then((function(t){e.dataSources=t,e.dataSourceOptions=Object.keys(e.dataSources).map((function(e){return{value:e,label:e}})),e.forceUpdate()})):(e.dataSources={col1:[1,2,3],col2:[4,3,2],col3:[17,13,9]},e.dataSourceOptions=Object.keys(e.dataSources).map((function(e){return{value:e,label:e}}))),e.state={data:[],layout:{},frames:[]},window.self!==window.top){var r=Object(p.a)(e);T.imjoyRPC.setupRPC({name:"ImJoy Chart Editor"}).then((function(e){e.export({setup:function(){return Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("imjoy-rpc initialized."),e.next=3,r._initPromise;case 3:case"end":return e.stop()}}),e)})))()},run:function(e){return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e&&e.config&&(r.saveDataHandler=e.config.saveDataHandler),e&&e.data&&(r.setState(e.data),r.dataSources=e.data.dataSources||{},r.dataSourceOptions=e.data.dataSourceOptions||Object.keys(r.dataSources).map((function(e){return{value:e,label:e}})),r.state.dataSources&&delete r.state.dataSources,r.state.dataSourceOptions&&delete r.state.dataSourceOptions),r.forceUpdate();case 3:case"end":return t.stop()}}),t)})))()},setWidgets:function(e){r.widgets=e,r.forceUpdate()},addWidget:function(e){r.widgets.push(e),r.forceUpdate()},removeWidget:function(){var e=r.widgets.filter((function(e){return e.name===widget.name}))[0];if(!e)throw new Error("Widget not found: "+widget.name);r.widgets.splice(r.widgets.indexOf(e),1),r.forceUpdate()},updateWidget:function(e){var t=r.widgets.filter((function(t){return t.name===e.name}))[0];if(!t)throw new Error("Widget not found: "+e.name);r.widgets[r.widgets.indexOf(t)]=e,r.forceUpdate()},setState:function(e){r.setState(e),r.forceUpdate()},getState:function(){return r.state},addListener:function(e){var t=e.event,a=e.callback;document.getElementById(r.plotDivId).on(t,(function(e){e.points?a(function(e){for(var t=[],a=0;a<e.length;a++)t.push({x:e[a].x,y:e[a].y,z:e[a].z||void 0});return t}(e.points)):a(e)}))},removeAllListeners:function(e){document.getElementById(r.plotDivId).removeAllListeners(e)}})}))}return e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e._initPromiseResolve()}),0)}},{key:"loadData",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,o,s=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=20;break}if(!t.split("?")[0].endsWith(".json")){e.next=16;break}return e.next=4,fetch(t);case 4:return a=e.sent,e.next=7,a.json();case 7:if(!(n=e.sent).data||!n.layout){e.next=13;break}this.setState(n),this.forceUpdate(),e.next=14;break;case 13:throw new Error("Invalid file type");case 14:e.next=18;break;case 16:if(t.split("?")[0].endsWith(".csv")){e.next=18;break}throw new Error("Invalid file extension, only .json and .csv are supported");case 18:e.next=21;break;case 20:t instanceof Blob&&t.name.endsWith(".json")&&((r=new FileReader).addEventListener("load",(function(e){var t=JSON.parse(r.result);if(!t.data||!t.layout)throw new Error("Invalid file type");s.setState(t),s.forceUpdate()})),r.readAsText(t));case 21:return e.next=23,N(t);case 23:o=e.sent,this.dataSources=o,this.dataSourceOptions=Object.keys(this.dataSources).map((function(e){return{value:e,label:e}})),this.forceUpdate();case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(D.jsx)("div",{className:"app",children:Object(D.jsx)(g.a,{data:this.state.data,layout:this.state.layout,config:H,frames:this.state.frames,dataSources:this.dataSources,dataSourceOptions:this.dataSourceOptions,plotly:x.a,onUpdate:function(t,a,n){e.setState({data:t,layout:a,frames:n})},useResizeHandler:!0,debug:!0,glByDefault:!0,showFieldTooltips:!0,advancedTraceTypeSelector:!0,divId:this.plotDivId,children:Object(D.jsx)(L,{logoSrc:"./static/icons/favicon-96x96.png",dataSources:this.dataSources,divId:this.plotDivId,data:this.state,widgets:this.widgets,handleSaveData:this.saveDataHandler,handleLoadData:this.loadData.bind(this)})})})}}]),a}(n.Component);s.a.render(Object(D.jsx)(B,{}),document.getElementById("root"))},471:function(e,t,a){}},[[1279,1,2]]]);
//# sourceMappingURL=main.a4c46a9c.chunk.js.map