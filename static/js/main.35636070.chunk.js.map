{"version":3,"sources":["CustomEditor.js","App.js","index.js"],"names":["download","filename","base64","element","document","createElement","setAttribute","style","display","body","appendChild","click","removeChild","CustomEditor","props","inputFile","React","createRef","exportWidth","exportHeight","exportFormat","exportFileName","_","this","context","localize","logo","logoSrc","src","dataSources","Object","entries","index","value","push","length","widgets","widget","type","name","padding","schema","uiSchema","onChange","e","apply","onSubmit","onError","width","objectFit","dangerouslySetInnerHTML","__html","exportChart","format","a","plotly","toImage","divId","height","replace","menuPanelOrder","group","hasTransforms","hasAxes","hasMaps","hasLegend","hasColorbars","hasSliders","hasMenus","children","label","v","forceUpdate","onUpdate","units","options","clearable","defaultValue","variant","onClick","handleLoadData","target","files","ref","current","handleSaveData","data","DefaultEditor","config","editable","loadCSV","url","Promise","resolve","reject","Papa","startsWith","header","dynamicTyping","skipEmptyLines","error","err","file","inputElem","reason","alert","toString","complete","results","result","row","key","transpose","dtypeToTypedArray","int8","Int8Array","int16","Int16Array","int32","Int32Array","uint8","Uint8Array","uint16","Uint16Array","uint32","Uint32Array","float32","Float32Array","float64","Float64Array","array","Array","App","plotDivId","Math","random","substr","_initPromise","_initPromiseResolve","load","RegExp","exec","location","search","decodeURIComponent","getUrlParameter","saveDataHandler","then","dataSourceOptions","keys","map","col1","col2","col3","state","layout","frames","window","self","top","imjoyRPC","setupRPC","api","registerCodec","decoder","obj","_rdtype","ret","ArrayBuffer","_rvalue","byteLength","i","Int64LE","toNumber","Uint64LE","arrayType","export","setup","console","log","run","ctx","setState","loadDataSource","loadData","setWidgets","addWidget","removeWidget","w","filter","wd","Error","splice","indexOf","updateWidget","getState","addListener","event","callback","getElementById","on","points","customdata","k","pointIndex","x","y","z","undefined","cleanUpPoints","removeAllListeners","setTimeout","split","endsWith","fetch","response","json","Blob","fr","FileReader","addEventListener","JSON","parse","readAsText","className","useResizeHandler","debug","glByDefault","showFieldTooltips","advancedTraceTypeSelector","bind","Component","ReactDOM","render"],"mappings":"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","file":"static/js/main.35636070.chunk.js","sourcesContent":["import React from \"react\";\nimport plotly from \"plotly.js/dist/plotly\";\nimport Form from \"@rjsf/core\";\n\nimport {\n  PlotlyFold,\n  PanelMenuWrapper,\n  Info,\n  LayoutPanel,\n  Button,\n  SingleSidebarItem,\n  DefaultEditor,\n  GraphCreatePanel,\n  GraphTransformsPanel,\n  GraphSubplotsPanel,\n  StyleLayoutPanel,\n  StyleAxesPanel,\n  StyleMapsPanel,\n  StyleLegendPanel,\n  StyleNotesPanel,\n  StyleShapesPanel,\n  StyleSlidersPanel,\n  StyleImagesPanel,\n  StyleTracesPanel,\n  StyleColorbarsPanel,\n  StyleUpdateMenusPanel,\n} from \"react-chart-editor\";\nimport Field from \"react-chart-editor/lib/components/fields/Field\";\nimport Logo from \"react-chart-editor/lib/components/widgets/Logo\";\nimport NumericInput from \"react-chart-editor/lib/components/widgets/NumericInput\";\nimport DropdownWidget from \"react-chart-editor/lib/components/widgets/Dropdown\";\nimport TextInput from \"react-chart-editor/lib/components/widgets/TextInput\";\n\nfunction download(filename, base64) {\n  const element = document.createElement(\"a\");\n  element.setAttribute(\"href\", base64);\n  element.setAttribute(\"download\", filename);\n\n  element.style.display = \"none\";\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\nexport default class CustomEditor extends DefaultEditor {\n  constructor(props) {\n    super(props);\n    this.inputFile = React.createRef();\n    this.exportWidth = 1024;\n    this.exportHeight = 1024;\n    this.exportFormat = \"png\";\n    this.exportFileName = \"imjoy-chart-export\";\n  }\n\n  render() {\n    const _ = this.context.localize;\n    const logo = this.props.logoSrc && <Logo src={this.props.logoSrc} />;\n\n    const dataSources = [];\n    if (this.props.dataSources) {\n      for (const [index, value] of Object.entries(this.props.dataSources)) {\n        dataSources.push(\n          <li key={index}>\n            {index}:{value.length}\n          </li>\n        );\n      }\n    }\n\n    const widgets = [];\n    if (this.props.widgets) {\n      for (let widget of this.props.widgets) {\n        if (widget.type === \"form\") {\n          widgets.push(\n            <PlotlyFold name={widget.name} key={widget.name}>\n              <div style={{ padding: \"10px\" }}>\n                <Form\n                  schema={widget.schema}\n                  uiSchema={widget.uiSchema}\n                  onChange={(e) => {\n                    widget.onChange && widget.onChange.apply(null, [e]);\n                  }}\n                  onSubmit={(e) => {\n                    widget.onSubmit && widget.onSubmit.apply(null, [e]);\n                  }}\n                  onError={(e) => {\n                    widget.onError && widget.onError.apply(null, [e]);\n                  }}\n                />\n              </div>\n            </PlotlyFold>\n          );\n        } else if (widget.type === \"image\") {\n          widgets.push(\n            <PlotlyFold name={widget.name} key={widget.name}>\n              {widget.src && (\n                <img\n                  style={{ width: \"100%\", objectFit: \"cover\" }}\n                  src={widget.src}\n                ></img>\n              )}\n            </PlotlyFold>\n          );\n        } else if (widget.type === \"html\") {\n          widgets.push(\n            <PlotlyFold name={widget.name} key={widget.name}>\n              <div style={{ padding: \"10px\" }}>\n                <div dangerouslySetInnerHTML={{ __html: widget.body }} />\n              </div>\n            </PlotlyFold>\n          );\n        }\n      }\n    }\n\n    const exportChart = async (format) => {\n      format = format || this.exportFormat;\n      const base64 = await plotly.toImage(this.props.divId, {\n        format: format,\n        height: this.exportHeight,\n        width: this.exportWidth,\n      });\n      download(\n        this.exportFileName + \".\" + format.replace(\"full-json\", \"json\"),\n        base64\n      );\n    };\n    return (\n      <PanelMenuWrapper menuPanelOrder={this.props.menuPanelOrder}>\n        {logo ? logo : null}\n        <GraphCreatePanel group={_(\"Structure\")} name={_(\"Traces\")} />\n        <GraphSubplotsPanel group={_(\"Structure\")} name={_(\"Subplots\")} />\n        {this.hasTransforms() && (\n          <GraphTransformsPanel group={_(\"Structure\")} name={_(\"Transforms\")} />\n        )}\n        <StyleLayoutPanel group={_(\"Style\")} name={_(\"General\")} />\n        <StyleTracesPanel group={_(\"Style\")} name={_(\"Traces\")} />\n        {this.hasAxes() && (\n          <StyleAxesPanel group={_(\"Style\")} name={_(\"Axes\")} />\n        )}\n        {this.hasMaps() && (\n          <StyleMapsPanel group={_(\"Style\")} name={_(\"Maps\")} />\n        )}\n        {this.hasLegend() && (\n          <StyleLegendPanel group={_(\"Style\")} name={_(\"Legend\")} />\n        )}\n        {this.hasColorbars() && (\n          <StyleColorbarsPanel group={_(\"Style\")} name={_(\"Color Bars\")} />\n        )}\n        <StyleNotesPanel group={_(\"Annotate\")} name={_(\"Text\")} />\n        <StyleShapesPanel group={_(\"Annotate\")} name={_(\"Shapes\")} />\n        <StyleImagesPanel group={_(\"Annotate\")} name={_(\"Images\")} />\n        {this.hasSliders() && (\n          <StyleSlidersPanel group={_(\"Control\")} name={_(\"Sliders\")} />\n        )}\n        {this.hasMenus() && (\n          <StyleUpdateMenusPanel group={_(\"Control\")} name={_(\"Menus\")} />\n        )}\n        {this.props.children ? this.props.children : null}\n\n        {/* ---custom widgets-- */}\n        <LayoutPanel group={_(\"Info\")} name={_(\"Info\")}>\n          {widgets}\n        </LayoutPanel>\n        <LayoutPanel group={_(\"Export\")} name=\"image\">\n          <PlotlyFold>\n            <Field label=\"Width\">\n              <NumericInput\n                value={this.exportWidth}\n                onChange={(v) => {\n                  this.exportWidth = v;\n                  this.forceUpdate();\n                }}\n                onUpdate={(v) => {\n                  this.exportWidth = v;\n                  this.forceUpdate();\n                }}\n                units=\"px\"\n              />\n            </Field>\n            <Field label=\"Height\">\n              <NumericInput\n                value={this.exportHeight}\n                onChange={(v) => {\n                  this.exportHeight = v;\n                  this.forceUpdate();\n                }}\n                onUpdate={(v) => {\n                  this.exportHeight = v;\n                  this.forceUpdate();\n                }}\n                units=\"px\"\n              />\n            </Field>\n\n            <Field label=\"Format\">\n              <DropdownWidget\n                options={[\n                  { label: \"PNG\", value: \"png\" },\n                  { label: \"JPEG\", value: \"jpeg\" },\n                  { label: \"WEBP\", value: \"webp\" },\n                  { label: \"SVG\", value: \"svg\" },\n                  { label: \"JSON\", value: \"full-json\" },\n                ]}\n                value={this.exportFormat}\n                onChange={(v) => {\n                  this.exportFormat = v;\n                  this.forceUpdate();\n                }}\n                clearable={false}\n              />\n            </Field>\n            <Field label=\"File Name\">\n              <TextInput\n                value={this.exportFileName}\n                defaultValue={this.exportFileName}\n                onUpdate={(v) => {\n                  this.exportFileName = v;\n                  this.forceUpdate();\n                }}\n              />\n            </Field>\n\n            <Field>\n              <Button\n                variant=\"primary\"\n                label=\"Export\"\n                onClick={() => {\n                  exportChart();\n                }}\n              />\n            </Field>\n          </PlotlyFold>\n        </LayoutPanel>\n        <SingleSidebarItem>\n          <input\n            type=\"file\"\n            onChange={(e) => {\n              this.props.handleLoadData(e.target.files[0]);\n            }}\n            ref={this.inputFile}\n            style={{ display: \"none\" }}\n          />\n          <Button\n            variant=\"primary\"\n            label=\"Load\"\n            onClick={() => {\n              this.inputFile.current.click();\n            }}\n          />\n        </SingleSidebarItem>\n\n        <SingleSidebarItem>\n          <Button\n            variant=\"primary\"\n            label=\"save\"\n            onClick={async () => {\n              if (this.props.handleSaveData)\n                this.props.handleLoadData(this.props.data);\n              else exportChart(\"full-json\");\n            }}\n          />\n        </SingleSidebarItem>\n      </PanelMenuWrapper>\n    );\n  }\n}\n","import React, { Component } from \"react\";\nimport plotly from \"plotly.js/dist/plotly\";\nimport PlotlyEditor from \"react-chart-editor\";\nimport CustomEditor from \"./CustomEditor\";\nimport \"react-chart-editor/lib/react-chart-editor.css\";\nimport { imjoyRPC } from \"imjoy-rpc\";\nimport * as Papa from \"papaparse\";\nimport { Uint64LE, Int64LE } from \"int64-buffer\";\n\nconst config = { editable: true };\n\nfunction loadCSV(url) {\n  return new Promise((resolve, reject) => {\n    Papa.parse(url, {\n      download: url.startsWith(\"http\"),\n      header: true,\n      dynamicTyping: true,\n      skipEmptyLines: true,\n      error: (err, file, inputElem, reason) => {\n        alert(\"Falied to load the table: \" + reason.toString());\n        reject(reason);\n      },\n      complete: (results) => {\n        resolve(transpose(results.data));\n      },\n    });\n  });\n}\n\nfunction transpose(data) {\n  let result = {};\n  for (let row of data) {\n    for (let [key, value] of Object.entries(row)) {\n      result[key] = result[key] || [];\n      result[key].push(value);\n    }\n  }\n  return result;\n}\n\nfunction randId() {\n  return \"_\" + Math.random().toString(36).substr(2, 9);\n}\n\nfunction getUrlParameter(name) {\n  name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\n  var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\");\n  var results = regex.exec(location.search);\n  return results === null\n    ? \"\"\n    : decodeURIComponent(results[1].replace(/\\+/g, \" \"));\n}\n\nfunction cleanUpPoints(dataSources, points) {\n  const data = [];\n  for (let i = 0; i < points.length; i++) {\n    const customdata = {};\n    for (let k of Object.keys(dataSources)) {\n      customdata[k] = dataSources[k][points[i].pointIndex];\n    }\n    data.push({\n      pointIndex: points[i].pointIndex,\n      x: points[i].x,\n      y: points[i].y,\n      z: points[i].z || undefined,\n      customdata: customdata,\n    });\n  }\n  return data;\n}\n\nconst dtypeToTypedArray = {\n  int8: Int8Array,\n  int16: Int16Array,\n  int32: Int32Array,\n  uint8: Uint8Array,\n  uint16: Uint16Array,\n  uint32: Uint32Array,\n  float32: Float32Array,\n  float64: Float64Array,\n  array: Array,\n};\n\nclass App extends Component {\n  constructor() {\n    super();\n    this.widgets = [];\n    this.plotDivId = randId();\n    this._initPromise = new Promise((resolve) => {\n      this._initPromiseResolve = resolve;\n    });\n\n    let load = getUrlParameter(\"load\");\n    this.saveDataHandler = null;\n    if (load) {\n      loadCSV(load).then((data) => {\n        this.dataSources = data;\n        this.dataSourceOptions = Object.keys(this.dataSources).map((name) => ({\n          value: name,\n          label: name,\n        }));\n        this.forceUpdate();\n      });\n    } else {\n      this.dataSources = {\n        col1: [1, 2, 3], // eslint-disable-line no-magic-numbers\n        col2: [4, 3, 2], // eslint-disable-line no-magic-numbers\n        col3: [17, 13, 9], // eslint-disable-line no-magic-numbers\n      };\n\n      this.dataSourceOptions = Object.keys(this.dataSources).map((name) => ({\n        value: name,\n        label: name,\n      }));\n    }\n    this.state = {\n      data: [],\n      layout: {},\n      frames: [],\n    };\n    // if inside an iframe, setup imjoy rpc\n    if (window.self !== window.top) {\n      const self = this;\n      imjoyRPC.setupRPC({ name: \"ImJoy Chart Editor\" }).then((api) => {\n        api.registerCodec({\n          name: \"ndarray\",\n          decoder(obj) {\n            if (obj._rdtype === \"int64\") {\n              const ret = new Uint32Array(\n                new ArrayBuffer(obj._rvalue.byteLength / 2)\n              );\n              for (let i = 0; i < obj._rvalue.byteLength; i += 8) {\n                ret[i / 8] = new Int64LE(obj._rvalue, i).toNumber();\n              }\n              return ret;\n            }\n            if (obj._rdtype === \"uint64\") {\n              const ret = new Uint32Array(\n                new ArrayBuffer(obj._rvalue.byteLength / 2)\n              );\n              for (let i = 0; i < obj._rvalue.byteLength; i += 8) {\n                ret[i / 8] = new Uint64LE(obj._rvalue, i).toNumber();\n              }\n              return ret;\n            }\n            const arrayType = dtypeToTypedArray[obj._rdtype];\n            return new arrayType(obj._rvalue);\n          },\n        });\n        api.export({\n          async setup() {\n            console.log(\"imjoy-rpc initialized.\");\n            await self._initPromise;\n          },\n          async run(ctx) {\n            if (ctx && ctx.config) {\n              self.saveDataHandler = ctx.config.saveDataHandler;\n            }\n            if (ctx && ctx.data) {\n              self.setState(ctx.data);\n              self.dataSources = ctx.data.dataSources || {};\n              self.dataSourceOptions =\n                ctx.data.dataSourceOptions ||\n                Object.keys(self.dataSources).map((name) => ({\n                  value: name,\n                  label: name,\n                }));\n              if (self.state.dataSources) delete self.state.dataSources;\n              if (self.state.dataSourceOptions)\n                delete self.state.dataSourceOptions;\n            }\n            self.forceUpdate();\n          },\n          async loadDataSource(file) {\n            await self.loadData(file);\n          },\n          setWidgets(widgets) {\n            self.widgets = widgets;\n            self.forceUpdate();\n          },\n          addWidget(widget) {\n            self.widgets.push(widget);\n            self.forceUpdate();\n          },\n          removeWidget() {\n            const w = self.widgets.filter((wd) => wd.name === widget.name)[0];\n            if (w) {\n              // remove widget\n              self.widgets.splice(self.widgets.indexOf(w), 1);\n              self.forceUpdate();\n            } else {\n              throw new Error(\"Widget not found: \" + widget.name);\n            }\n          },\n          updateWidget(widget) {\n            const w = self.widgets.filter((wd) => wd.name === widget.name)[0];\n            if (w) {\n              // replace widget\n              self.widgets[self.widgets.indexOf(w)] = widget;\n              self.forceUpdate();\n            } else {\n              throw new Error(\"Widget not found: \" + widget.name);\n            }\n          },\n          setState(state) {\n            self.setState(state);\n            self.forceUpdate();\n          },\n          getState() {\n            return self.state;\n          },\n          addListener({ event, callback }) {\n            document.getElementById(self.plotDivId).on(event, (data) => {\n              if (data.points)\n                callback(cleanUpPoints(self.dataSources, data.points));\n              else {\n                callback(data);\n              }\n            });\n          },\n          removeAllListeners(event) {\n            document.getElementById(self.plotDivId).removeAllListeners(event);\n          },\n        });\n      });\n    }\n  }\n\n  componentDidMount() {\n    setTimeout(() => {\n      this._initPromiseResolve();\n    }, 0);\n  }\n\n  async loadData(file) {\n    let data;\n    if (typeof file === \"object\") {\n      data = file;\n    } else {\n      if (typeof file === \"string\" && file.startsWith(\"http\")) {\n        if (file.split(\"?\")[0].endsWith(\".json\")) {\n          const response = await fetch(file);\n          const data = await response.json();\n          if (data.data && data.layout) {\n            this.setState(data);\n            this.forceUpdate();\n          } else {\n            throw new Error(\"Invalid file type\");\n          }\n        } else if (!file.split(\"?\")[0].endsWith(\".csv\")) {\n          throw new Error(\n            \"Invalid file extension, only .json and .csv are supported\"\n          );\n        }\n      } else if (file instanceof Blob) {\n        if (file.name.endsWith(\".json\")) {\n          const fr = new FileReader();\n          fr.addEventListener(\"load\", (e) => {\n            const data = JSON.parse(fr.result);\n            if (data.data && data.layout) {\n              this.setState(data);\n              this.forceUpdate();\n            } else {\n              throw new Error(\"Invalid file type\");\n            }\n          });\n\n          fr.readAsText(file);\n        }\n      }\n      data = await loadCSV(file);\n    }\n    this.dataSources = data;\n    this.dataSourceOptions = Object.keys(this.dataSources).map((name) => ({\n      value: name,\n      label: name,\n    }));\n    this.forceUpdate();\n  }\n\n  render() {\n    return (\n      <div className=\"app\">\n        <PlotlyEditor\n          data={this.state.data}\n          layout={this.state.layout}\n          config={config}\n          frames={this.state.frames}\n          dataSources={this.dataSources}\n          dataSourceOptions={this.dataSourceOptions}\n          plotly={plotly}\n          onUpdate={(data, layout, frames) => {\n            this.setState({ data, layout, frames });\n          }}\n          useResizeHandler\n          debug\n          glByDefault\n          showFieldTooltips\n          advancedTraceTypeSelector\n          divId={this.plotDivId}\n        >\n          <CustomEditor\n            logoSrc={\"./static/icons/favicon-96x96.png\"}\n            dataSources={this.dataSources}\n            divId={this.plotDivId}\n            data={this.state}\n            widgets={this.widgets}\n            handleSaveData={this.saveDataHandler}\n            handleLoadData={this.loadData.bind(this)}\n          />\n        </PlotlyEditor>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}