(this["webpackJsonpimjoy-chart-editor"]=this["webpackJsonpimjoy-chart-editor"]||[]).push([[0],{310:function(e,t,a){},983:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(36),s=a.n(o),i=(a(310),a(38)),c=a.n(i),l=a(75),u=a(106),d=a(107),p=a(108),h=a(114),j=a(112),f=a(113),b=a(290),x=a(109),m=a.n(x),O=a(10),v=a.n(O),S=a(7),y=a.n(S),g=a(163),P=a.n(g),w=a(51),k=a.n(w),I=a(35),C=a.n(I),F=a(74),D=a.n(F),U=a(5);function E(e,t){var a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}var T=function(e){Object(h.a)(a,e);var t=Object(j.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).inputFile=r.a.createRef(),n.exportWidth=1024,n.exportHeight=1024,n.exportFormat="png",n.exportFileName="imjoy-chart-export",n}return Object(d.a)(a,[{key:"render",value:function(){var e=this,t=this.context.localize,a=this.props.logoSrc&&Object(U.jsx)(P.a,{src:this.props.logoSrc}),n=[];if(this.props.dataSources)for(var r=0,o=Object.entries(this.props.dataSources);r<o.length;r++){var s=Object(f.a)(o[r],2),i=s[0],u=s[1];n.push(Object(U.jsxs)("li",{children:[i,":",u.length]},i))}var d=function(){var t=Object(l.a)(c.a.mark((function t(a){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=a||e.exportFormat,t.next=3,m.a.toImage(e.props.divId,{format:a,height:e.exportHeight,width:e.exportWidth});case 3:n=t.sent,E(e.exportFileName+"."+a.replace("full-json","json"),n);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(U.jsxs)(O.PanelMenuWrapper,{menuPanelOrder:this.props.menuPanelOrder,children:[a||null,Object(U.jsx)(O.GraphCreatePanel,{group:t("Structure"),name:t("Traces")}),Object(U.jsx)(O.GraphSubplotsPanel,{group:t("Structure"),name:t("Subplots")}),this.hasTransforms()&&Object(U.jsx)(O.GraphTransformsPanel,{group:t("Structure"),name:t("Transforms")}),Object(U.jsx)(O.StyleLayoutPanel,{group:t("Style"),name:t("General")}),Object(U.jsx)(O.StyleTracesPanel,{group:t("Style"),name:t("Traces")}),this.hasAxes()&&Object(U.jsx)(O.StyleAxesPanel,{group:t("Style"),name:t("Axes")}),this.hasMaps()&&Object(U.jsx)(O.StyleMapsPanel,{group:t("Style"),name:t("Maps")}),this.hasLegend()&&Object(U.jsx)(O.StyleLegendPanel,{group:t("Style"),name:t("Legend")}),this.hasColorbars()&&Object(U.jsx)(O.StyleColorbarsPanel,{group:t("Style"),name:t("Color Bars")}),Object(U.jsx)(O.StyleNotesPanel,{group:t("Annotate"),name:t("Text")}),Object(U.jsx)(O.StyleShapesPanel,{group:t("Annotate"),name:t("Shapes")}),Object(U.jsx)(O.StyleImagesPanel,{group:t("Annotate"),name:t("Images")}),this.hasSliders()&&Object(U.jsx)(O.StyleSlidersPanel,{group:t("Control"),name:t("Sliders")}),this.hasMenus()&&Object(U.jsx)(O.StyleUpdateMenusPanel,{group:t("Control"),name:t("Menus")}),this.props.children?this.props.children:null,Object(U.jsx)(O.LayoutPanel,{group:t("Annotate"),name:t("Info"),children:Object(U.jsx)(O.PlotlyFold,{name:"PlotlyFold",children:Object(U.jsxs)(O.Info,{attr:"title",children:[Object(U.jsx)("p",{children:"This custom editor demonstrates the general-purpose container and field components."}),Object(U.jsxs)("p",{children:["This is an ",Object(U.jsx)("code",{children:"Info"})," component."]})]})})}),Object(U.jsx)(O.LayoutPanel,{group:t("Export"),name:"image",children:Object(U.jsxs)(O.PlotlyFold,{children:[Object(U.jsx)(y.a,{label:"Width",children:Object(U.jsx)(k.a,{value:this.exportWidth,onChange:function(t){e.exportWidth=t,e.forceUpdate()},onUpdate:function(t){e.exportWidth=t,e.forceUpdate()},units:"px"})}),Object(U.jsx)(y.a,{label:"Height",children:Object(U.jsx)(k.a,{value:this.exportHeight,onChange:function(t){e.exportHeight=t,e.forceUpdate()},onUpdate:function(t){e.exportHeight=t,e.forceUpdate()},units:"px"})}),Object(U.jsx)(y.a,{label:"Format",children:Object(U.jsx)(C.a,{options:[{label:"PNG",value:"png"},{label:"JPEG",value:"jpeg"},{label:"WEBP",value:"webp"},{label:"SVG",value:"svg"},{label:"JSON",value:"full-json"}],value:this.exportFormat,onChange:function(t){e.exportFormat=t,e.forceUpdate()},clearable:!1})}),Object(U.jsx)(y.a,{label:"File Name",children:Object(U.jsx)(D.a,{value:this.exportFileName,defaultValue:this.exportFileName,onUpdate:function(t){e.exportFileName=t,e.forceUpdate()}})}),Object(U.jsx)(y.a,{children:Object(U.jsx)(O.Button,{variant:"primary",label:"Export",onClick:function(){d()}})})]})}),Object(U.jsxs)(O.SingleSidebarItem,{children:[Object(U.jsx)("input",{type:"file",onChange:function(t){e.props.handleLoadData(t.target.files[0])},ref:this.inputFile,style:{display:"none"}}),Object(U.jsx)(O.Button,{variant:"primary",label:"Load",onClick:function(){e.inputFile.current.click()}})]}),Object(U.jsx)(O.SingleSidebarItem,{children:Object(U.jsx)(O.Button,{variant:"primary",label:"save",onClick:Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.props.handleSaveData?e.props.handleLoadData(e.props.data):d("full-json");case 1:case"end":return t.stop()}}),t)})))})})]})}}]),a}(O.DefaultEditor),L=(a(963),a(303)),A=a(304),H={editable:!0};function N(e){return new Promise((function(t,a){A.parse(e,{download:!0,header:!0,dynamicTyping:!0,skipEmptyLines:!0,error:function(e,t,n,r){alert("Falied to load the table: "+r.toString()),a(r)},complete:function(e){t(function(e){var t,a={},n=Object(b.a)(e);try{for(n.s();!(t=n.n()).done;)for(var r=t.value,o=0,s=Object.entries(r);o<s.length;o++){var i=Object(f.a)(s[o],2),c=i[0],l=i[1];a[c]=a[c]||[],a[c].push(l)}}catch(u){n.e(u)}finally{n.f()}return a}(e.data))}})}))}var W=function(e){Object(h.a)(a,e);var t=Object(j.a)(a);function a(){var e;Object(u.a)(this,a),(e=t.call(this)).plotDivId="_"+Math.random().toString(36).substr(2,9);var n=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}("load");if(e.saveDataHandler=null,n?N(n).then((function(t){e.dataSources=t,e.dataSourceOptions=Object.keys(e.dataSources).map((function(e){return{value:e,label:e}})),e.forceUpdate()})):(e.dataSources={col1:[1,2,3],col2:[4,3,2],col3:[17,13,9]},e.dataSourceOptions=Object.keys(e.dataSources).map((function(e){return{value:e,label:e}}))),e.state={data:[],layout:{},frames:[]},window.self!==window.top){var r=Object(p.a)(e);L.imjoyRPC.setupRPC({name:"ImJoy Chart Editor"}).then((function(e){e.export({setup:function(){console.log("imjoy-rpc initialized.")},run:function(e){e&&e.config&&(r.saveDataHandler=e.config.saveDataHandler),e&&e.data&&(r.setState(e.data),r.dataSources=e.data.dataSources||{},r.dataSourceOptions=e.data.dataSourceOptions||Object.keys(r.dataSources).map((function(e){return{value:e,label:e}})),r.state.dataSources&&delete r.data.dataSources,r.state.dataSourceOptions&&delete r.data.dataSourceOptions),r.forceUpdate()},setState:function(e){r.setState(e),r.forceUpdate()},getState:function(){return r.state},on:function(e,t){document.getElementById(this.plotDivId).on(e,(function(e){e.points?t(function(e){for(var t=[],a=0;a<e.length;a++)t.push({x:e[a].x,y:e[a].y,z:e[a].z||void 0});return t}(e.points)):t(e)}))},off:function(e){document.getElementById(this.plotDivId).removeAllListeners(e)}})}))}return e}return Object(d.a)(a,[{key:"loadData",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,o,s=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=20;break}if(!t.split("?")[0].endsWith(".json")){e.next=16;break}return e.next=4,fetch(t);case 4:return a=e.sent,e.next=7,a.json();case 7:if(!(n=e.sent).data||!n.layout){e.next=13;break}this.setState(n),this.forceUpdate(),e.next=14;break;case 13:throw new Error("Invalid file type");case 14:e.next=18;break;case 16:if(t.split("?")[0].endsWith(".csv")){e.next=18;break}throw new Error("Invalid file extension, only .json and .csv are supported");case 18:e.next=21;break;case 20:t instanceof Blob&&t.name.endsWith(".json")&&((r=new FileReader).addEventListener("load",(function(e){var t=JSON.parse(r.result);if(!t.data||!t.layout)throw new Error("Invalid file type");s.setState(t),s.forceUpdate()})),r.readAsText(t));case 21:return e.next=23,N(t);case 23:o=e.sent,this.dataSources=o,this.dataSourceOptions=Object.keys(this.dataSources).map((function(e){return{value:e,label:e}})),this.forceUpdate();case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(U.jsx)("div",{className:"app",children:Object(U.jsx)(v.a,{data:this.state.data,layout:this.state.layout,config:H,frames:this.state.frames,dataSources:this.dataSources,dataSourceOptions:this.dataSourceOptions,plotly:m.a,onUpdate:function(t,a,n){e.setState({data:t,layout:a,frames:n})},useResizeHandler:!0,debug:!0,glByDefault:!0,showFieldTooltips:!0,advancedTraceTypeSelector:!0,divId:this.plotDivId,children:Object(U.jsx)(T,{logoSrc:"./static/icons/favicon-96x96.png",dataSources:this.dataSources,divId:this.plotDivId,data:this.state,handleSaveData:this.saveDataHandler,handleLoadData:this.loadData.bind(this)})})})}}]),a}(n.Component);s.a.render(Object(U.jsx)(W,{}),document.getElementById("root"))}},[[983,1,2]]]);
//# sourceMappingURL=main.e82d3e28.chunk.js.map