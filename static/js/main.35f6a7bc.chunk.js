(this["webpackJsonpimjoy-chart-editor"]=this["webpackJsonpimjoy-chart-editor"]||[]).push([[0],{1284:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(47),i=a.n(o),s=(a(472),a(23)),c=a.n(s),l=a(61),u=a(163),d=a(164),p=a(165),h=a(174),f=a(172),j=a(173),b=a(166),m=a(167),v=a.n(m),x=a(12),y=a.n(x),g=a(466),O=a(8),S=a.n(O),w=a(255),P=a.n(w),C=a(73),k=a.n(C),I=a(46),D=a.n(I),U=a(116),A=a.n(U),F=a(5);function E(e,t){var a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}var L=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).inputFile=r.a.createRef(),n.exportWidth=1024,n.exportHeight=1024,n.exportFormat="png",n.exportFileName="imjoy-chart-export",n}return Object(d.a)(a,[{key:"render",value:function(){var e=this,t=this.context.localize,a=this.props.logoSrc&&Object(F.jsx)(P.a,{src:this.props.logoSrc}),n=[];if(this.props.dataSources)for(var r=0,o=Object.entries(this.props.dataSources);r<o.length;r++){var i=Object(j.a)(o[r],2),s=i[0],u=i[1];n.push(Object(F.jsxs)("li",{children:[s,":",u.length]},s))}var d=[];if(this.props.widgets){var p,h=Object(b.a)(this.props.widgets);try{var f=function(){var e=p.value;"form"===e.type?d.push(Object(F.jsx)(x.PlotlyFold,{name:e.name,children:Object(F.jsx)("div",{style:{padding:"10px"},children:Object(F.jsx)(g.a,{schema:e.schema,uiSchema:e.uiSchema,onChange:function(t){e.onChange&&e.onChange.apply(null,[t])},onSubmit:function(t){e.onSubmit&&e.onSubmit.apply(null,[t])},onError:function(t){e.onError&&e.onError.apply(null,[t])}})})},e.name)):"image"===e.type?d.push(Object(F.jsx)(x.PlotlyFold,{name:e.name,children:e.src&&Object(F.jsx)("img",{style:{width:"100%",objectFit:"cover"},src:e.src})},e.name)):"html"===e.type&&d.push(Object(F.jsx)(x.PlotlyFold,{name:e.name,children:Object(F.jsx)("div",{style:{padding:"10px"},children:Object(F.jsx)("div",{dangerouslySetInnerHTML:{__html:e.body}})})},e.name))};for(h.s();!(p=h.n()).done;)f()}catch(y){h.e(y)}finally{h.f()}}var m=function(){var t=Object(l.a)(c.a.mark((function t(a){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=a||e.exportFormat,t.next=3,v.a.toImage(e.props.divId,{format:a,height:e.exportHeight,width:e.exportWidth});case 3:n=t.sent,E(e.exportFileName+"."+a.replace("full-json","json"),n);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(F.jsxs)(x.PanelMenuWrapper,{menuPanelOrder:this.props.menuPanelOrder,children:[a||null,Object(F.jsx)(x.GraphCreatePanel,{group:t("Structure"),name:t("Traces")}),Object(F.jsx)(x.GraphSubplotsPanel,{group:t("Structure"),name:t("Subplots")}),this.hasTransforms()&&Object(F.jsx)(x.GraphTransformsPanel,{group:t("Structure"),name:t("Transforms")}),Object(F.jsx)(x.StyleLayoutPanel,{group:t("Style"),name:t("General")}),Object(F.jsx)(x.StyleTracesPanel,{group:t("Style"),name:t("Traces")}),this.hasAxes()&&Object(F.jsx)(x.StyleAxesPanel,{group:t("Style"),name:t("Axes")}),this.hasMaps()&&Object(F.jsx)(x.StyleMapsPanel,{group:t("Style"),name:t("Maps")}),this.hasLegend()&&Object(F.jsx)(x.StyleLegendPanel,{group:t("Style"),name:t("Legend")}),this.hasColorbars()&&Object(F.jsx)(x.StyleColorbarsPanel,{group:t("Style"),name:t("Color Bars")}),Object(F.jsx)(x.StyleNotesPanel,{group:t("Annotate"),name:t("Text")}),Object(F.jsx)(x.StyleShapesPanel,{group:t("Annotate"),name:t("Shapes")}),Object(F.jsx)(x.StyleImagesPanel,{group:t("Annotate"),name:t("Images")}),this.hasSliders()&&Object(F.jsx)(x.StyleSlidersPanel,{group:t("Control"),name:t("Sliders")}),this.hasMenus()&&Object(F.jsx)(x.StyleUpdateMenusPanel,{group:t("Control"),name:t("Menus")}),this.props.children?this.props.children:null,Object(F.jsx)(x.LayoutPanel,{group:t("Info"),name:t("Info"),children:d}),Object(F.jsx)(x.LayoutPanel,{group:t("Export"),name:"image",children:Object(F.jsxs)(x.PlotlyFold,{children:[Object(F.jsx)(S.a,{label:"Width",children:Object(F.jsx)(k.a,{value:this.exportWidth,onChange:function(t){e.exportWidth=t,e.forceUpdate()},onUpdate:function(t){e.exportWidth=t,e.forceUpdate()},units:"px"})}),Object(F.jsx)(S.a,{label:"Height",children:Object(F.jsx)(k.a,{value:this.exportHeight,onChange:function(t){e.exportHeight=t,e.forceUpdate()},onUpdate:function(t){e.exportHeight=t,e.forceUpdate()},units:"px"})}),Object(F.jsx)(S.a,{label:"Format",children:Object(F.jsx)(D.a,{options:[{label:"PNG",value:"png"},{label:"JPEG",value:"jpeg"},{label:"WEBP",value:"webp"},{label:"SVG",value:"svg"},{label:"JSON",value:"full-json"}],value:this.exportFormat,onChange:function(t){e.exportFormat=t,e.forceUpdate()},clearable:!1})}),Object(F.jsx)(S.a,{label:"File Name",children:Object(F.jsx)(A.a,{value:this.exportFileName,defaultValue:this.exportFileName,onUpdate:function(t){e.exportFileName=t,e.forceUpdate()}})}),Object(F.jsx)(S.a,{children:Object(F.jsx)(x.Button,{variant:"primary",label:"Export",onClick:function(){m()}})})]})}),Object(F.jsxs)(x.SingleSidebarItem,{children:[Object(F.jsx)("input",{type:"file",onChange:function(t){e.props.handleLoadData(t.target.files[0])},ref:this.inputFile,style:{display:"none"}}),Object(F.jsx)(x.Button,{variant:"primary",label:"Load",onClick:function(){e.inputFile.current.click()}})]}),Object(F.jsx)(x.SingleSidebarItem,{children:Object(F.jsx)(x.Button,{variant:"primary",label:"save",onClick:Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.props.handleSaveData?e.props.handleSaveData(e.props.data):m("full-json");case 1:case"end":return t.stop()}}),t)})))})})]})}}]),a}(x.DefaultEditor),W=(a(1260),a(464)),H=a(465),_=a(261),T={editable:!0};function N(e){return new Promise((function(t,a){H.parse(e,{download:e.startsWith("http"),header:!0,dynamicTyping:!0,skipEmptyLines:!0,error:function(e,t,n,r){alert("Falied to load the table: "+r.toString()),a(r)},complete:function(e){t(function(e){var t,a={},n=Object(b.a)(e);try{for(n.s();!(t=n.n()).done;)for(var r=t.value,o=0,i=Object.entries(r);o<i.length;o++){var s=Object(j.a)(i[o],2),c=s[0],l=s[1];a[c]=a[c]||[],a[c].push(l)}}catch(u){n.e(u)}finally{n.f()}return a}(e.data))}})}))}function B(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}var M={int8:Int8Array,int16:Int16Array,int32:Int32Array,uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,float32:Float32Array,float64:Float64Array,array:Array},R=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(u.a)(this,a),(e=t.call(this)).widgets=[],e.plotDivId="_"+Math.random().toString(36).substr(2,9),e._initPromise=new Promise((function(t){e._initPromiseResolve=t}));var n=B("load");if(e.hideControls=!!B("hideControls"),e.saveDataHandler=null,e.loadDataHandler=null,n?e.loadData(n):(e.dataSources={col1:[1,2,3],col2:[4,3,2],col3:[17,13,9]},e.dataSourceOptions=Object.keys(e.dataSources).map((function(e){return{value:e,label:e}}))),e.state={data:[],layout:{},frames:[]},window.self!==window.top){var r=Object(p.a)(e);W.imjoyRPC.setupRPC({name:"ImJoy Chart Editor"}).then((function(e){e.registerCodec({name:"ndarray",decoder:function(e){if("int64"===e._rdtype){for(var t=new Uint32Array(new ArrayBuffer(e._rvalue.byteLength/2)),a=0;a<e._rvalue.byteLength;a+=8)t[a/8]=new _.Int64LE(e._rvalue,a).toNumber();return t}if("uint64"===e._rdtype){for(var n=new Uint32Array(new ArrayBuffer(e._rvalue.byteLength/2)),r=0;r<e._rvalue.byteLength;r+=8)n[r/8]=new _.Uint64LE(e._rvalue,r).toNumber();return n}return new(0,M[e._rdtype])(e._rvalue)}}),e.export({setup:function(){return Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("imjoy-rpc initialized."),e.next=3,r._initPromise;case 3:case"end":return e.stop()}}),e)})))()},run:function(e){return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e&&e.config&&(void 0!==e.config.saveDataHandler&&(r.saveDataHandler=e.config.saveDataHandler),void 0!==e.config.loadDataHandler&&(r.loadDataHandler=e.config.loadDataHandler),void 0!==e.config.hideControls&&(r.hideControls=e.config.hideControls)),e&&e.data&&(r.dataSources=e.data.dataSources||{},r.dataSourceOptions=e.data.dataSourceOptions||Object.keys(r.dataSources).map((function(e){return{value:e,label:e}})),r.state.dataSources&&delete r.state.dataSources,r.state.dataSourceOptions&&delete r.state.dataSourceOptions,r.setState(e.data)),r.forceUpdate();case 3:case"end":return t.stop()}}),t)})))()},loadDataSource:function(e){return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.loadData(e);case 2:case"end":return t.stop()}}),t)})))()},hideControls:function(e){r.hideControls=e,r.forceUpdate()},setWidgets:function(e){r.widgets=e,r.forceUpdate()},addWidget:function(e){r.widgets.push(e),r.forceUpdate()},removeWidget:function(){var e=r.widgets.filter((function(e){return e.name===widget.name}))[0];if(!e)throw new Error("Widget not found: "+widget.name);r.widgets.splice(r.widgets.indexOf(e),1),r.forceUpdate()},updateWidget:function(e){var t=r.widgets.filter((function(t){return t.name===e.name}))[0];if(!t)throw new Error("Widget not found: "+e.name);r.widgets[r.widgets.indexOf(t)]=e,r.forceUpdate()},setState:function(e){r.setState(e),r.forceUpdate()},getState:function(){return r.state},addListener:function(e){var t=e.event,a=e.callback;document.getElementById(r.plotDivId).on(t,(function(e){e.points?a(function(e,t){for(var a=[],n=0;n<t.length;n++){for(var r={},o=0,i=Object.keys(e);o<i.length;o++){var s=i[o];r[s]=e[s][t[n].pointIndex]}a.push({pointIndex:t[n].pointIndex,x:t[n].x,y:t[n].y,z:t[n].z||void 0,customdata:r})}return a}(r.dataSources,e.points)):a(e)}))},removeAllListeners:function(e){document.getElementById(r.plotDivId).removeAllListeners(e)}})}))}return e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e._initPromiseResolve()}),0)}},{key:"loadData",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,o,i=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"!==typeof t){e.next=4;break}a=t,e.next=29;break;case 4:if("string"!==typeof t||!t.startsWith("http")){e.next=25;break}if(!t.split("?")[0].endsWith(".json")){e.next=21;break}return e.next=8,fetch(t);case 8:return n=e.sent,e.next=11,n.json();case 11:if(!(r=e.sent).data||!r.layout){e.next=18;break}return this.setState(r),this.forceUpdate(),e.abrupt("return");case 18:throw new Error("Invalid file type");case 19:e.next=23;break;case 21:if(t.split("?")[0].endsWith(".csv")){e.next=23;break}throw new Error("Invalid file extension, only .json and .csv are supported");case 23:e.next=26;break;case 25:t instanceof Blob&&t.name.endsWith(".json")&&((o=new FileReader).addEventListener("load",(function(e){var t=JSON.parse(o.result);if(!t.data||!t.layout)throw new Error("Invalid file type");i.setState(t),i.forceUpdate()})),o.readAsText(t));case 26:return e.next=28,N(t);case 28:a=e.sent;case 29:this.dataSources=a,this.dataSourceOptions=Object.keys(this.dataSources).map((function(e){return{value:e,label:e}})),this.forceUpdate();case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(F.jsx)("div",{className:"app",children:Object(F.jsx)(y.a,{hideControls:this.hideControls,data:this.state.data,layout:this.state.layout,config:T,frames:this.state.frames,dataSources:this.dataSources,dataSourceOptions:this.dataSourceOptions,plotly:v.a,onUpdate:function(t,a,n){e.setState({data:t,layout:a,frames:n})},useResizeHandler:!0,debug:!0,glByDefault:!0,showFieldTooltips:!0,advancedTraceTypeSelector:!0,divId:this.plotDivId,children:Object(F.jsx)(L,{logoSrc:"./static/icons/favicon-96x96.png",dataSources:this.dataSources,divId:this.plotDivId,data:this.state,widgets:this.widgets,handleSaveData:this.saveDataHandler,handleLoadData:this.loadDataHandler||this.loadData.bind(this)})})})}}]),a}(n.Component);i.a.render(Object(F.jsx)(R,{}),document.getElementById("root"))},472:function(e,t,a){}},[[1284,1,2]]]);
//# sourceMappingURL=main.35f6a7bc.chunk.js.map